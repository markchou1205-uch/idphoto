import urllib.request
import urllib.error
import json

KEY = "9R4yKV3pVJAMIwE040Pwp4pyH5Mslu3vJp7gz82iQZClGdSQuH7xJQQJ99BLACqBBLyXJ3w3AAAKACOGKXtB"
# Tiny valid JPEG
VALID_IMAGE_BLOB = b'\xff\xd8\xff\xe0\x00\x10JFIF\x00\x01\x01\x01\x00H\x00H\x00\x00\xff\xdb\x00C\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xdb\x00C\x01\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xc0\x00\x11\x08\x00\x01\x00\x01\x03\x01\x22\x00\x02\x11\x01\x03\x11\x01\xff\xc4\x00\x15\x00\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xff\xc4\x00\x14\x10\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xc4\x00\x14\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xc4\x00\x14\x11\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xda\x00\x0c\x03\x01\x00\x02\x11\x03\x11\x00?\x00\xbf\x00\xff\xd9'

def test_model(model_name):
    # User requested combination: landmarks + attributes + specific model
    # Note: adding returnFaceLandmarks=true
    endpoint = f"https://my-face-check-01.cognitiveservices.azure.com/face/v1.0/detect?returnFaceAttributes=glasses,occlusion&returnFaceLandmarks=true&detectionModel={model_name}&returnFaceId=false"
    
    print(f"\n--- Testing {model_name} ---")
    headers = {
        'Ocp-Apim-Subscription-Key': KEY,
        'Content-Type': 'application/octet-stream'
    }

    req = urllib.request.Request(endpoint, data=VALID_IMAGE_BLOB, headers=headers, method='POST')

    try:
        with urllib.request.urlopen(req) as response:
            print(f"Success! Status: {response.status}")
            data = json.loads(response.read().decode('utf-8'))
            print("Response keys:", data[0].keys() if data else "No face found (expected for partial img)")
    except urllib.error.HTTPError as e:
        print(f"Failed! Status: {e.code}")
        print(e.read().decode('utf-8'))
    except Exception as e:
        print(f"Error: {e}")

# Test both to see which one works for the USER'S requirements
test_model("detection_01")
test_model("detection_03")
