<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Studio Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<button id="sidebar-toggle-btn" class="btn btn-primary rounded-circle shadow" onclick="toggleSidebar(true)">
    <i class="bi bi-list"></i>
</button>

<div class="d-flex w-100 h-100 overflow-hidden">
    
    <div id="sidebar-icons" class="d-flex flex-column align-items-center py-3 border-end bg-dark text-white">
        <div class="mb-4 fs-4 fw-bold text-primary"><i class="bi bi-camera-fill"></i></div>
        
        <div class="nav flex-column w-100 text-center gap-2">
            <div class="nav-item-icon active" onclick="switchFeature('id-photo', this)" title="證件照">
                <i class="bi bi-person-badge-fill"></i>
                <span class="small d-block" style="font-size: 10px;">證件照</span>
            </div>
            <div class="nav-item-icon" onclick="switchFeature('job-photo', this)" title="求職照">
                <i class="bi bi-briefcase-fill"></i>
                <span class="small d-block" style="font-size: 10px;">求職照</span>
            </div>
            <div class="nav-item-icon" onclick="switchFeature('grad-photo', this)" title="畢業照">
                <i class="bi bi-mortarboard-fill"></i>
                <span class="small d-block" style="font-size: 10px;">畢業照</span>
            </div>
            <div class="nav-item-icon" onclick="switchFeature('beauty', this)" title="美顏">
                <i class="bi bi-magic"></i>
                <span class="small d-block" style="font-size: 10px;">美顏</span>
            </div>
            <div class="nav-item-icon" onclick="switchFeature('restore', this)" title="老圖翻新">
                <i class="bi bi-hourglass-split"></i>
                <span class="small d-block" style="font-size: 10px;">翻新</span>
            </div>
        </div>

        <div class="mt-auto mb-3 nav-item-icon text-danger" onclick="location.reload()" title="重置">
            <i class="bi bi-power"></i>
        </div>
    </div>

    <div id="sidebar-panels" class="bg-white border-end position-relative">
        <button class="btn btn-sm btn-light border position-absolute top-0 end-0 m-2" onclick="toggleSidebar(false)">
            <i class="bi bi-chevron-left"></i>
        </button>

        <div id="panel-id-photo" class="feature-panel h-100 p-4 overflow-auto">
            <h4 class="fw-bold mb-4">證件照製作</h4>
            
            <div id="step-upload">
                <div class="upload-box p-4 text-center border rounded bg-light mb-4">
                    <input type="file" id="fileInput" accept="image/*" hidden onchange="handleFileUpload(this)">
                    <button class="btn btn-primary w-100 py-2" onclick="document.getElementById('fileInput').click()">
                        <i class="bi bi-folder2-open me-2"></i> 選擇檔案
                    </button>
                    <div class="small text-muted mt-2">支援 JPG, PNG</div>
                </div>
            </div>

            <div id="step-specs" class="d-none animate-fade">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="fw-bold text-muted small">選擇規格</label>
                    <a href="#" class="text-decoration-none small" onclick="resetUpload()">重選照片</a>
                </div>
                <div id="specs-container" class="vstack gap-2 mb-3"></div>
                
                <div class="spec-card p-2 border rounded text-center mb-3" onclick="toggleCustom()">
                    <i class="bi bi-pencil-square"></i> 自訂尺寸
                </div>
                <div id="custom-inputs" class="d-none row g-1 mb-3">
                    <div class="col"><input type="number" id="custom-w" class="form-control form-control-sm" placeholder="寬mm" oninput="updateCustom()"></div>
                    <div class="col"><input type="number" id="custom-h" class="form-control form-control-sm" placeholder="高mm" oninput="updateCustom()"></div>
                </div>

                <button class="btn btn-primary w-100 py-2 fw-bold shadow-sm" onclick="processImage()">
                    <i class="bi bi-lightning-charge-fill"></i> 開始製作
                </button>
                <div class="mt-2 text-center small text-muted" id="spec-desc"></div>
            </div>

            <div id="step-result" class="d-none animate-fade">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <label class="fw-bold text-muted small">預覽與下載</label>
                    <a href="#" class="text-decoration-none small" onclick="location.reload()">下一張</a>
                </div>

                <div class="d-flex gap-2 mb-3">
                    <div onclick="selectResult('white')" class="result-btn flex-fill p-2 border rounded text-center active" id="res-white">
                        <small class="fw-bold d-block mb-1">白底</small>
                        <img id="img-white" class="img-fluid rounded" style="max-height: 80px;">
                    </div>
                    <div onclick="selectResult('blue')" class="result-btn flex-fill p-2 border rounded text-center" id="res-blue">
                        <small class="fw-bold d-block mb-1">藍底</small>
                        <img id="img-blue" class="img-fluid rounded" style="max-height: 80px;">
                    </div>
                </div>

                <div class="vstack gap-2">
                    <button class="btn btn-success w-100" onclick="downloadImage()"><i class="bi bi-download"></i> 下載高清圖</button>
                    <button class="btn btn-dark w-100" onclick="generateLayout()"><i class="bi bi-grid-3x3"></i> 下載 4x6 排版</button>
                    <button class="btn btn-outline-primary w-100" onclick="toggleEmailInput()"><i class="bi bi-envelope"></i> 寄到信箱</button>
                </div>
                
                <div id="email-group" class="d-none mt-2 p-2 bg-light rounded border">
                    <div class="input-group input-group-sm">
                        <input type="email" id="user-email" class="form-control" placeholder="Email">
                        <button class="btn btn-primary" onclick="sendEmail()">發送</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-job-photo" class="feature-panel d-none p-4 text-center pt-5">
            <i class="bi bi-briefcase fs-1 text-muted"></i><h5 class="mt-3">職場換裝</h5><p class="small text-muted">3090 核心準備中...</p>
        </div>
        <div id="panel-grad-photo" class="feature-panel d-none p-4 text-center pt-5">
            <i class="bi bi-mortarboard fs-1 text-muted"></i><h5 class="mt-3">畢業照</h5><p class="small text-muted">3090 核心準備中...</p>
        </div>
         <div id="panel-beauty" class="feature-panel d-none p-4 text-center pt-5">
            <i class="bi bi-magic fs-1 text-muted"></i><h5 class="mt-3">美顏修圖</h5><p class="small text-muted">開發中...</p>
        </div>
         <div id="panel-restore" class="feature-panel d-none p-4 text-center pt-5">
            <i class="bi bi-hourglass-split fs-1 text-muted"></i><h5 class="mt-3">老圖翻新</h5><p class="small text-muted">3090 核心準備中...</p>
        </div>
    </div>

    <div id="main-content" class="flex-grow-1 bg-light position-relative d-flex align-items-center justify-content-center overflow-hidden">
        
        <div class="loading-overlay" id="loading">
            <div class="spinner-border text-primary" role="status"></div>
            <div class="mt-2 fw-bold text-dark">處理中...</div>
        </div>

        <div class="image-wrapper shadow-lg" style="position: relative; width: fit-content; max-width: 90%; max-height: 90%;">
            <img id="previewImg" src="" class="d-none img-fluid rounded" style="display: block; max-height: 85vh;">
            
            <div id="cropMask" class="crop-mask d-none">
                <div class="mask-label" id="maskLabel"></div>
            </div>
        </div>

        <div id="empty-msg" class="text-center text-muted opacity-50">
            <i class="bi bi-image" style="font-size: 5rem;"></i>
            <h4 class="mt-3">預覽區域</h4>
            <p>請從左側上傳照片</p>
        </div>
    </div>
</div>

<div class="modal fade" id="checkModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">AI 合規檢查</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="check-results-list" class="list-group"></div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="main.js"></script>
</body>
</html>
